
# TODO

Why is both the RTC and the hardware watchdog controlling the transmit
shutdown?  It would seem only one or the other would be necessary.

The inductors for impedance matching the output of the LNA are on the
bottom of the board.  This isn't ideal, as they aren't in a shield,
but it's pretty crowded in the LNA shield.

Probably remove the L1/L2 inductor on the AX5043s and replace them
with a short.  I don't think we will use them.

What UFL connectors can be removed?

Do we need all those wire holes?  A few I can understand, for powering
the board on the bench, but there are a bunch of them, some with just
grounds.

Clean up all the schematic notes and number all the device references
in a logical manner.

Does it make sense to wire the UARTs to the PC104?  If so, do we need
two of them on the PC104?  Shouldn't one go to a plug somewhere?  If
so, which one?

Figure out what all the PC104 pins are supposed to do and document
them.

Replace the RTC with one that is temperature rated.  Probably only the
MCP7940NT-E/MS from Microchip is suitable.  It does not have an
interrupt output, though.

Figure out where the external RF connections need to be so the layout
can be simplified around that.

Maybe switch to 0402 parts along the RF path to reduce stray
inductance and capacitance and reduce size.  Maybe on the rest of the
board to get more space.

Replace unobtanium parts (if any).

Figure out temperature ratings on all chips and get as many to be 105C
or better as possible.

# Done

Figure out how to hold the processor in reset until the power is good.
Need power good output from the converters, maybe switch to a
TPSM828302 for 1.2V and a LP3962 for 3.3V.

Replace big capacitors with smaller ones, if possible.

Move the TX chain to the right side of the board under the power
handling.

Move JTAG next to processor.

Replace the 4 512Kx8 MRAM chips with one 2Mx8 like the Avalanche 
AS1016204-0108X0PWAY.

Replace the DC/DC converters to ones that have the inductor built in,
to save space.

Move most power handling and watchdogs to the to right hand part of
the board.

Move the RX ax5043s to below and slightly left of the processor.  Move
the RF chain to below that.

Possibly rework board stack to have .1mm between the top layer and the
ground layer to reduce trace size required for 50 ohms.
(This was already done.)

Wire VER_BIT2 to the PC104 connector.

Figure out the best way to handle the RX side of the AX5043 chips.  A
single-ended design would save a lot of board space because you can
get rid of one RF power splitter and the balun.  The AX5043 docs are
kind of sparse about how to do that, there's no mention of input
impedance on the receive side, and the transmit impedance info is
unhelpful.  But the full RF filter input as shown in the documentation
probably isn't required.  Maybe a balun on each RF input would be
enough to match impedance, since the signal is already filtered.

Replace receive side with LNA not requiring negative bias.  Probably
use a Qorvo QPL9547 due to its low NF.  Or maybe a GuerillaRF GRF2106W
which doesn't perform quite as well but uses a lot less power.

Put filters on each side of the LNA.

Make the 5V regulator optional or remove it.
(Removed, but space left for it.)

Possibly switch the MRAM and AX5043 SPI busses to simplify routine.

Figure out a way to disable the LNA from the CPU.

Find out why CURRENT_FAULT_U89 goes into two pins on the CPU.

Choose one oscillator and remove the other one.  Actually, just
replace with a "O 16,0-JT22CT-A-P-3,3-LF" from Jauch.

Neaten up the spacing on the AX5043s.

Add a thermsistor for the CPU.

Add CAN bus.

Add resistors to the MRAM SPI connection.

Does the JTAG interface need resistors on TCK and TDO (22 ohm)?
That's pretty standard.

The RF lines need some rework, some from the hybrid to the AX5043s are
kind of long, and they probably need to be coplaner.  I have added a
coplaner net class for this board stack (.225mm trace, .7mm spacing).

Shield on receive AX5043s.

Shield on transmit AX5043.

Decoupling, at least on 1.2V, seem inadequate.  Check that out.

Figure out how to orient the shields properly.

Add an option for a bleedoff inductor on the transmit output.

Via impedance

The chosen shield size for the AX5043s isn't tall enough.  The
transform is inside the shield, and it's 3.05mm tall, but all the
shields of the chosen size are 2.54mm tall.  I can't find a suitable
shield smaller than that to put the transformer on the outside.  The
shields with the proper height are way too big.  I can find a few that
are 12.7x13.2mm that are 3.5mm tall, but they would need to be
customized to add holes for traces.  You could just add a hole for the
transformer, I suppose.  Or get a custom shield.  Some of the shields
are pretty open on the top, like the PIC-S-201F, and the transformer
looks like it will go through the hole in top.  The transformer is
4.19x4.45x3.05mm, but that's the base dimensions, the transformer part
that comes up is smaller.  The opening int the top of the shield is
2.35mm at the narrowest point.  Estimating the size of the transformer
from the pictures, I get 2.2mm.  The opening starts 1mm from the
bottom of the shield, and that means the transformer would have to be
pretty close to the bottom.  However, after more analysis, I had the
orientation wrong, it's rotated 90 degrees from what I thought.  So
it's not going to work.

The RX shields are now the PIC-S-201F, the TX shield is the PIC-S-101,
but the RX shields will need some change.

In the shield problem, will the transformer coming up through a steel
enclosure affect the performance of the transformer?

Shield on RX input section.

Shield on TX PA section.

Check the inductor on the LNA, really verify the whole thing.

Change the 1.2V power controller to a MP5073.

The "Current Fault_1V2" and "Current Fault_3V3" are not connected to
anything and can probably be removed with their pull up resistor.  I
don't think there's much value in hooking it to the processor, if
either of these fire the processor will crash.

Do we need the capacitor between the LNA and the filter?  The filter
datasheet shows an input capacitor first, so that should block the DC.
The only concern would be the DC bias characteristic changing the
value of the capacitor.  I've asked MiniCircuits about this.
* This had to be added for other reasons due to the impedance matching
  circuit.

Write a document describing all the interfaces from the processor to
the rest of the board.

There may need to be a delay on the reset line from the power good
outputs because the power limiting circuits may take time to turn on.

# Not going to do

Look at replacing the second from bottom layer with a ground layer so
the bottom layer can be used to route RF traces.  This may not be
necessary, though, with careful layout.

Rotate the CPU so that fewer traces need to be routed under the CPU.
Perhaps replace the CPU with a BGA version to save space, the BGA is
16x16mm verses 22x22mm for the flat pack.  This could also provide
more FLASH and RAM space.

On the output of the AX5043 transmit/input of the PA, there is each a
filter.  The one on the AX5043 has parts marked "NS", which I assume
means "don't populate".  The inductor is zero there.  C704 is also
marked NS on the PA sheet, which is most likely wrong.  Need to figure
all this out.

Analyze the RX input filter.

Figure out the AX5043 SPI routing.  Simulate the clock line in spice
to avoid possibility of double clocking, add proper resistors.

Add a thermsistor for the PA.

Route signals directly, don't use RF jumpers.

Rework transmit RF side.  At least replace the filter with a new one,
probably the LFCG-490+ from MiniCircuits, which also happens to be
temperature rated.


# 2025-07-23

The pins for AX5043_PWR_CTL moved (and I think was renamed) and there
is a new PA_PWR_CTL line.

The Address notes on the two MAX31725MTA+ temperature sensors were
backwards.  Switched the notes so they match the schematic.

VER_BIT2 is not wired to the PC104.

# 2025-07-24

Fixed all wiring that was wrong due to schematic changes.

Changed the RTC crystal to a SMD one and remove the capacitor.  The
datasheet says no capacitor is required.

Cleaned up some crazy traces.

# 2025-07-25

Reworked the board, basic layout is done and most details are handled.
Left to do:

* Clock handling

* Rework of the TX power amplier.

* Hooking everything up.

* The rest of the TODO list.

There should be no software visible changes from the changes today.

Remove the DS28E83Q+T crypto processor.  Nobody knew why it was there,
there was no software for it, and it wasn't practical.  Since there is
no onewire hardware on the CPU, it would have to be bit-banged, and
that would cost 50 times the CPU of just doing the crypto on the
board.

# 2025-07-26

Change the DC regulators to ones with power good pins and tie that in
to processor reset.

Removed the HW_POWER_OFF_N signal to the CPU.  The CPU is going to be
instantly powered off if that is not asserted, there's not much value
in sending it to a GPIO.

Remove the UART_RTS and UART_CTS connections.  The chip doesn't
support these lines, no point in having them.

Switched the MRAM and AX5043 SPI busses to simplify routing.  MRAM is
now on MIPSPI3, the AX5043 is on MIBSPI1.  This puts the AX5043 SPI
connection on the bottom of the processor by the AX5043s, and the MRAM
SPI where there is plenty of room to add MRAM devices as necessary.

Move AX5043_SEL1 from pin 24 to pin 90
Move AX5043_SEL2 from pin 33 to pin 91
Move AX5043_SEL3 from pin 35 to pin 92
Move AX5043_SEL4 from pin 35 to pin 96
Move AX5043_SEL_TX from pin 124 to pin 97

Added an LNA_ENABLE control on pin 89.

Removed the CURRENT_FAULT_U89 signal from pins 73 and 74.  They don't
go anywhere else and serve no purpose I can tell.

Clocks are all set up and wired in.

MRAM is wired in.

# 2025-07-27

Wired in the AX5043 SPI busses and all their control lines.

Added the following connections to the CPU:

AX5043_EN_RX1 to pin 36
AX5043_EN_RX2 to pin 35
AX5043_EN_RX3 to pin 33
AX5043_EN_RX4 to pin 32

Added a thermsistor to AD1IN_16.

The I2C temperature sensors are removed.

A thermsistor by the CPU was added to pin 58.

# 2025-07-28

Added calculations for the Qorvo TQP7M9106 to get Zin and Zout for the
frequency in question.

Rework the output PA to use a Qorvo TQP7M9106.  The old part was not
recommended for new designs, and the Qorvo part seems more efficient.
Do all the matching and such for that.

Added a termsistor by the PA.

Did simulations of the RF input and adjusted accordingly.

Did simulations of the AX5043 TX output.

Add a CAN bus.

Added a resistor to the MRAM SPI clock signal.

Add SMA connectors for TX and RX.

Added resistors to JTAG interface, per the way it's defined.

# 2025-07-29

Replaced UFL connectors with surface mount ones.

Added shields for the TX and RX AX5043 sections.  They are
12.7mmx13.67mm (.5"x.538").  That seems to be a pretty standard size,
lots are available.

Added a bunch of decoupling caps on the CPU, basically one per CPU,
like the launchpad did, and like is standard.

Switched the RX AX5043 shields to PIC-S-201F.  It appears that if
oriented correctly the transformer will stick through the hole without
a radial line on it.  The TX one was left as PIC-S-101, as it doesn't
have a transformer in the can and doesn't need the extra height.  Both
parts have the same base layout.

Sized up some power lines for safety margin.

Calculation of the via impedance (done at Sierra Circuits proto
express) comes out to ~52 ohms.  The board is 1.56mm thick (JLCPCB
2116 board stack), each copper layer is .035mm.  Input is:

  Height of dielectric - H1 ( mm ) - 1.416
  Dielectric Constant Er_1 - 4.5
  Height of dielectric - H2 ( mm ) - .109
  Dielectric Constant Er_2 - 4.5
  Dielectric Constant Er_3 - 4.5
  Via Diameter ( mm ) - .308
  Anti Pad Diameter ( mm ) - 1.53
  Annular Pad Diameter ( mm ) - .508
  Via Pad Diameter ( mm ) - .508
  Via Plating Thickness ( mm ) - .035
  Annular Pad Thickness ( mm ) - .035
  Reference Plane Thickness ( mm ) - .035

Reroute the SPI clock to the bottom of the board where it can be
impedance controlled to 50 ohms.  Add a ground plane on the bottom to
the entire RF section so that the impedance is the same as on the top.

Simulated the AX5043 SPI clock and set the resistor values to 470 ohms
and added a resistor for the end device, too.  With the current
settings, assuming a .2ns rise time from the processor, this gives a
fairly smooth signal on all the inputs.  The signal reaches 2.8V (from
0 to 3V input) or .2V (from 3V to 0) in 2ns.  Resistance values 330
and down give some issues at the RX2 input, there is a dip that could
be double-clocked on.  Higher values will slow the rise time more.
With this setup, no resistors on the other lines, as long as they
settle within half a clock period plus 2ns, all should be good.  You
could probably run this at 100MHz without an issue.  But the double
clocking is the big problem.

# 2025-07-30

To solve the problem with the transformer not fitting in the shield,
replace the transformer with a lumped sum balun as described by the
work Jim McCullers did in the "AX5043 Receiver Impedence Matching"
document.  I just used the values he came up with.  Changed all the
shields back to the PIC-S-101.  Also changed the zero-ohm resistor
from the RF splitter to the AX5043 to a decoupling capacitor.

Changed the zero-ohm resistor between the TX AX5043 and the PA to a
decoupling capacitor.

Changed the shields on the AX5043 to PIC-S-201F which is a frame and a
cover.  This can be replaced with a PIC-S-101 which is a single unit
when access is no longer needed to the parts underneath.

Added a shield for the TX PA and RX input sections.

Add a thermsistor for the power conversion area to pin 83.

Rework the RF input circuitry.  I had to increase the power feed
inductor and add an input and output impedance match circuit.  That
required changing the parts around the LNA to 0402 size to get them to
all fit.  You might be able to modify the input filter to adjust the
impedance, but I couldn't figure out how to do that to match a complex
impedance.  I'm sure it can be done, but it's a matter of how.

# 2025-07-31

Replaced the 1.2V current limiter/switch with a MP5073GG from
Monolithic Power.  The MAX4495 that was there wasn't rated for 1.2V.

Remove the Current Fault lines for 1.2V and 3.3V.  They didn't go
anywhere, and there's not much the processor could do about it if they
went bad.

Removed the zero ohm resistors on WDO_N, the enable line feeding the
current limit switches enables.  There's already a way to turn of the
watchdog on the watchdog chip, so it doesn't seem necessary.  Plus the
line needs to be driven to work.  Also renamed WDO_N to POWER_ENABLE
to better reflect what it does.

Wired in the power good pin on the MP5073GG-P to the processor reset
so that the processor is held in reset until 50us after the chip
enabled power.